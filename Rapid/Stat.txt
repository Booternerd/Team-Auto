MODULE Status
    
    PERS string Command;
    PERS num Param{17};
    PERS num NumParams;
    PERS num StatusNumParams;
    PERS bool UpdateFlag;
    PERS bool ControlFlag;
    PERS bool StatusFlag;
    VAR robjoint JointStatus;
    VAR pose PoseStatus;
    PROC MainStatus()
        StatusFlag := FALSE;
        WHILE TRUE DO
            IF StatusFlag THEN
                StatusNumParams := 6;
                JointStatus := GetAngles();
                Param{1} := JointStatus.rax_1;
                Param{2} := JointStatus.rax_2;
                Param{3} := JointStatus.rax_3;
                Param{4} := JointStatus.rax_4;
                Param{5} := JointStatus.rax_5;
                Param{6} := JointStatus.rax_6;
!                Param{1} := GetVacRun();
!                Param{2} := GetVacSuck();
!                Param{3} := GetConRun();
!                Param{4} := GetConDir();
                
!                PoseStatus := GetPose();
!                Param{5} := JointStatus.rax_1;
!                Param{6} := JointStatus.rax_2;
!                Param{7} := JointStatus.rax_3;
!                Param{8} := JointStatus.rax_4;
!                Param{9} := JointStatus.rax_5;
!                Param{10} := JointStatus.rax_6;
!                Param{11} := PoseStatus.trans.x;
!                Param{12} := PoseStatus.trans.y;
!                Param{13} := PoseStatus.trans.z;
!                Param{14} := PoseStatus.rot.q1;
!                Param{15} := PoseStatus.rot.q2;
!                Param{16} := PoseStatus.rot.q3;
!                Param{17} := PoseStatus.rot.q4;
                !Param{18} := aaa.rax_1;
                
                UpdateFlag := TRUE;
                StatusFlag := FALSE;
            ENDIF
        ENDWHILE
    ENDPROC
    
    FUNC pose GetPose()
        ! Return: current pose of end effector 
        ! usage : VAR pose rPos := get_Pose();
        !       : rPos.trans~give pos in mm
        !       : rpos.rot~orientation in quaternion
        VAR robtarget rb;
        rb := CRobT(\Tool:=tsCup);
        RETURN [rb.trans, rb.rot]; 
    ENDFUNC
    
    FUNC robjoint GetAngles()
        ! Return: current angle of all joints in degrees 
        ! usage : VAR robjoint rAng := get_Angles();
        VAR jointtarget rb;
        rb := CJointT();
        RETURN rb.robax; 
    ENDFUNC
    
    FUNC dionum GetVacRun()
        RETURN DO10_1; 
    ENDFUNC
    
    FUNC dionum GetVacSuck()
        RETURN DO10_2; 
    ENDFUNC
    
    FUNC dionum GetConRun()
        RETURN DO10_3; 
    ENDFUNC
    
    FUNC dionum GetConDir()
        RETURN DO10_4; 
    ENDFUNC
    
ENDMODULE
